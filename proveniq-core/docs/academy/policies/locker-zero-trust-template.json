{
  "$schema": "https://proveniq.com/schemas/security/policy-v1.json",
  "policy_id": "LOCKER-ZERO-TRUST-001",
  "version": "1.0.0",
  "name": "Locker Device Zero-Trust Policy",
  "description": "Zero-trust security policy for Locker hardware devices. Implements defense-in-depth against signal spoofing attacks.",
  "effective_date": "2024-01-15T00:00:00Z",
  "enforcement_mode": "enforce",
  "applies_to": {
    "device_types": ["LOCKER"],
    "environments": ["production", "staging"]
  },

  "device_authentication": {
    "required": true,
    "certificate": {
      "required": true,
      "issuer": {
        "must_match": "CN=Proveniq Device CA,O=Proveniq Inc,C=US",
        "allowed_issuers": [
          "CN=Proveniq Device CA,O=Proveniq Inc,C=US",
          "CN=Proveniq Device CA G2,O=Proveniq Inc,C=US"
        ]
      },
      "validity": {
        "check_expiration": true,
        "check_revocation": true,
        "revocation_check": "ocsp_with_crl_fallback",
        "max_age_days": 365
      },
      "key_requirements": {
        "min_key_size": 2048,
        "allowed_algorithms": ["RSA", "ECDSA"],
        "ecdsa_curves": ["P-256", "P-384"]
      },
      "extensions": {
        "require_device_id_extension": true,
        "device_id_oid": "1.3.6.1.4.1.99999.1.1"
      }
    },
    "mutual_tls": {
      "required": true,
      "client_cert_required": true,
      "verify_hostname": true
    }
  },

  "hardware_attestation": {
    "required": true,
    "tpm": {
      "required": true,
      "version": "2.0",
      "endorsement_key": {
        "verify": true,
        "trusted_manufacturers": [
          "Infineon",
          "STMicroelectronics",
          "Nuvoton"
        ]
      },
      "attestation_key": {
        "verify": true,
        "max_age_hours": 24
      },
      "pcr_validation": {
        "required": true,
        "expected_pcrs": {
          "PCR0": "firmware_hash",
          "PCR7": "secure_boot_policy"
        }
      }
    },
    "secure_element": {
      "required": true,
      "types": ["TPM", "HSM", "SE"],
      "anti_tamper": {
        "required": true,
        "check_interval_seconds": 60
      }
    },
    "freshness": {
      "max_attestation_age_seconds": 300,
      "require_nonce": true,
      "nonce_length": 32
    }
  },

  "network_controls": {
    "ip_allowlist": {
      "enabled": true,
      "mode": "strict",
      "allowed_ranges": [
        "10.100.0.0/16",
        "172.16.50.0/24",
        "192.168.100.0/24"
      ],
      "allowed_asns": [
        "AS12345",
        "AS67890"
      ],
      "geo_restrictions": {
        "enabled": true,
        "allowed_countries": ["US", "CA", "GB", "DE"],
        "block_vpn": true,
        "block_tor": true,
        "block_proxy": true
      }
    },
    "rate_limiting": {
      "enabled": true,
      "per_device": {
        "requests_per_minute": 60,
        "requests_per_hour": 500,
        "burst_limit": 10
      },
      "global": {
        "requests_per_minute": 10000
      }
    },
    "connection_requirements": {
      "require_tls": true,
      "min_tls_version": "1.3",
      "allowed_cipher_suites": [
        "TLS_AES_256_GCM_SHA384",
        "TLS_CHACHA20_POLY1305_SHA256"
      ]
    }
  },

  "behavioral_controls": {
    "timing_analysis": {
      "enabled": true,
      "min_response_time_ms": 100,
      "max_response_time_ms": 30000,
      "flag_suspiciously_fast": true,
      "fast_threshold_ms": 50
    },
    "sequence_validation": {
      "enabled": true,
      "require_monotonic_counter": true,
      "max_counter_gap": 10,
      "detect_replay": true,
      "replay_window_seconds": 300
    },
    "location_validation": {
      "enabled": true,
      "require_gps": true,
      "max_gps_accuracy_meters": 100,
      "velocity_check": {
        "enabled": true,
        "max_speed_kmh": 200,
        "impossible_travel_detection": true
      },
      "geofencing": {
        "enabled": true,
        "allowed_regions": ["registered_location"],
        "max_deviation_km": 50
      }
    },
    "anomaly_detection": {
      "enabled": true,
      "baseline_period_days": 30,
      "deviation_threshold": 3.0,
      "monitored_metrics": [
        "request_frequency",
        "payload_size",
        "response_patterns",
        "error_rates"
      ]
    }
  },

  "message_validation": {
    "signature": {
      "required": true,
      "algorithm": "ECDSA-SHA256",
      "verify_chain": true,
      "timestamp_tolerance_seconds": 60
    },
    "payload": {
      "schema_validation": true,
      "max_size_bytes": 1048576,
      "required_fields": [
        "device_id",
        "timestamp",
        "nonce",
        "signature"
      ],
      "sanitization": {
        "enabled": true,
        "strip_unknown_fields": true,
        "validate_urls": true,
        "block_external_urls": true
      }
    },
    "evidence": {
      "photo_validation": {
        "required": true,
        "must_be_internal_storage": true,
        "exif_verification": true,
        "hash_verification": true
      },
      "gps_validation": {
        "required": true,
        "precision_check": true,
        "reject_exact_coordinates": true,
        "min_decimal_variance": 0.00001
      }
    },
    "anti_replay": {
      "enabled": true,
      "nonce_required": true,
      "nonce_storage": "redis",
      "nonce_ttl_seconds": 3600,
      "timestamp_required": true,
      "max_clock_skew_seconds": 30
    }
  },

  "response_actions": {
    "on_violation": {
      "block_request": true,
      "log_event": true,
      "alert_security": true,
      "quarantine_device": {
        "enabled": true,
        "duration_minutes": 60,
        "require_manual_review": true
      }
    },
    "on_repeated_violations": {
      "threshold": 3,
      "window_minutes": 15,
      "actions": [
        "revoke_device_certificate",
        "block_ip_permanently",
        "alert_soc",
        "create_incident"
      ]
    },
    "on_critical_violation": {
      "triggers": [
        "forged_signature",
        "invalid_attestation",
        "impossible_travel"
      ],
      "actions": [
        "immediate_block",
        "revoke_all_sessions",
        "page_on_call",
        "preserve_forensics"
      ]
    },
    "audit": {
      "log_all_requests": true,
      "log_all_violations": true,
      "retention_days": 2555,
      "immutable_storage": true
    }
  },

  "exceptions": {
    "allowed": false,
    "require_approval": ["CISO", "Security Lead"],
    "max_duration_days": 7,
    "audit_exceptions": true
  },

  "monitoring": {
    "metrics": [
      "policy_evaluations_total",
      "policy_violations_total",
      "device_authentications_total",
      "attestation_failures_total"
    ],
    "alerts": [
      {
        "name": "high_violation_rate",
        "condition": "violations_per_minute > 10",
        "severity": "critical"
      },
      {
        "name": "attestation_failure_spike",
        "condition": "attestation_failures_per_hour > 50",
        "severity": "warning"
      },
      {
        "name": "spoofing_attempt_detected",
        "condition": "forged_signature_count > 0",
        "severity": "critical"
      }
    ],
    "dashboards": ["security-locker-overview", "zero-trust-compliance"]
  }
}
