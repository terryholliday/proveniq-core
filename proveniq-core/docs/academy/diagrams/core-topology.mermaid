%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#1a1a2e', 'primaryTextColor': '#eee', 'primaryBorderColor': '#4a9eff', 'lineColor': '#4a9eff', 'secondaryColor': '#16213e', 'tertiaryColor': '#0f3460'}}}%%

graph TB
    subgraph EDGE["â˜ï¸ EDGE LAYER"]
        CDN["ğŸŒ CDN / Load Balancer<br/>Vercel Edge Network"]
    end

    subgraph APPLICATIONS["ğŸ“± APPLICATION LAYER"]
        PORTAL["ğŸ–¥ï¸ Portal<br/>Customer Dashboard"]
        MOBILE["ğŸ“± Mobile<br/>Field Verification"]
        VERIFY["âœ… Verify<br/>Verification Workflows"]
        INGEST["ğŸ“¥ Ingest<br/>Data Pipelines"]
    end

    subgraph CORE_PLATFORM["ğŸ§  CORE PLATFORM"]
        CORE["âš¡ PROVENIQ CORE<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Authentication<br/>Authorization (RBAC)<br/>Multi-Tenancy<br/>Audit Logging<br/>Data Models<br/>API Gateway"]
    end

    subgraph SERVICES["âš™ï¸ SERVICE LAYER"]
        ANALYTICS["ğŸ“Š Analytics<br/>BI & Reporting"]
        INTEGRATIONS["ğŸ”Œ Integrations<br/>DocuSign, Plaid, S3"]
    end

    subgraph DATA["ğŸ’¾ DATA LAYER"]
        RDS[("ğŸ—„ï¸ PostgreSQL<br/>AWS RDS<br/>â”â”â”â”â”â”â”â”â”â”<br/>Primary: Write<br/>Replica: Read")]
        S3["ğŸ“¦ S3<br/>Document Storage"]
        REDIS["âš¡ Redis<br/>Cache & Sessions"]
    end

    %% Edge connections
    CDN --> PORTAL
    CDN --> MOBILE
    CDN --> VERIFY
    CDN --> INGEST

    %% Application to Core
    PORTAL --> CORE
    MOBILE --> CORE
    VERIFY --> CORE
    INGEST --> CORE

    %% Core to Services
    CORE --> ANALYTICS
    CORE --> INTEGRATIONS

    %% Service dependencies
    ANALYTICS --> CORE
    INTEGRATIONS --> CORE

    %% Portal uses Analytics
    PORTAL -.-> ANALYTICS

    %% Verify/Ingest use Integrations
    VERIFY -.-> INTEGRATIONS
    INGEST -.-> INTEGRATIONS

    %% Data layer connections
    CORE --> RDS
    CORE --> REDIS
    ANALYTICS --> RDS
    INTEGRATIONS --> S3

    %% Styling
    classDef core fill:#4a9eff,stroke:#fff,stroke-width:3px,color:#000
    classDef app fill:#16213e,stroke:#4a9eff,stroke-width:2px,color:#fff
    classDef service fill:#0f3460,stroke:#4a9eff,stroke-width:1px,color:#fff
    classDef data fill:#1a1a2e,stroke:#4a9eff,stroke-width:2px,color:#fff
    classDef edge fill:#2d3436,stroke:#4a9eff,stroke-width:1px,color:#fff

    class CORE core
    class PORTAL,MOBILE,VERIFY,INGEST app
    class ANALYTICS,INTEGRATIONS service
    class RDS,S3,REDIS data
    class CDN edge
