%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#1a1a2e', 'primaryTextColor': '#eee', 'primaryBorderColor': '#4a9eff', 'lineColor': '#4a9eff', 'secondaryColor': '#16213e', 'tertiaryColor': '#0f3460', 'edgeLabelBackground': '#1a1a2e'}}}%%

flowchart TB
    subgraph HAPPY["âœ… HAPPY PATH"]
        direction TB
        
        H1[/"ðŸ“¥ Client Request"/]
        H2["ðŸ” Auth & Validate"]
        H3["ðŸ“ Begin Transaction"]
        H4["ðŸ’¾ Ledger: Create Record"]
        H5["ðŸ”— Locker: Link Hardware"]
        H6["âœ… Commit Transaction"]
        H7["ðŸ“‹ Queue Verification"]
        H8["ðŸ“Š Audit Log"]
        H9[/"ðŸ“¤ 201 Created"/]
        
        H1 --> H2
        H2 --> H3
        H3 --> H4
        H4 --> H5
        H5 --> H6
        H6 --> H7
        H7 --> H8
        H8 --> H9
        
        style H1 fill:#22c55e,stroke:#fff,color:#000
        style H9 fill:#22c55e,stroke:#fff,color:#000
    end

    subgraph FAILURE["âŒ FAILURE PATH"]
        direction TB
        
        F1[/"ðŸ“¥ Client Request"/]
        F2["ðŸ” Auth & Validate"]
        F3["ðŸ“ Begin Transaction"]
        F4["ðŸ’¾ Ledger: Create Record"]
        F5["ðŸ”— Locker: Link Hardware"]
        F6{{"âš ï¸ TIMEOUT"}}
        F7["ðŸ”„ Partial Commit"]
        F8["ðŸ“¬ Queue to DLQ"]
        F9["ðŸ“Š Audit Log"]
        F10[/"ðŸ“¤ 202 Accepted"/]
        F11["â° Retry Loop"]
        F12{{"Success?"}}
        F13["âœ… Complete Link"]
        F14["ðŸš¨ Alert Ops"]
        
        F1 --> F2
        F2 --> F3
        F3 --> F4
        F4 --> F5
        F5 --> F6
        F6 --> F7
        F7 --> F8
        F8 --> F9
        F9 --> F10
        F8 -.-> F11
        F11 --> F12
        F12 -->|Yes| F13
        F12 -->|No x5| F14
        
        style F1 fill:#ef4444,stroke:#fff,color:#000
        style F6 fill:#f59e0b,stroke:#fff,color:#000
        style F10 fill:#f59e0b,stroke:#fff,color:#000
        style F14 fill:#ef4444,stroke:#fff,color:#000
        style F13 fill:#22c55e,stroke:#fff,color:#000
    end

    HAPPY ~~~ FAILURE
