# IAM Policies & RBAC Reference
## C200: The Iron Gate

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  [DRILL_INSTRUCTOR] CONTENT ARTIFACT                                         â•‘
â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â•‘
â•‘                                                                              â•‘
â•‘  Document:     IAM Policies & RBAC Reference                                 â•‘
â•‘  Track:        C200 - The Iron Gate                                          â•‘
â•‘  Classification: TRAINING MATERIAL                                           â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ” IDENTITY & ACCESS MANAGEMENT ARCHITECTURE

### The IAM Stack

```mermaid
graph TB
    subgraph IDENTITY["ğŸªª IDENTITY LAYER"]
        AUTH["Authentication<br/>Who are you?"]
    end

    subgraph ACCESS["ğŸ”‘ ACCESS LAYER"]
        AUTHZ["Authorization<br/>What can you do?"]
    end

    subgraph POLICY["ğŸ“œ POLICY LAYER"]
        RBAC["Role-Based Access Control"]
        ABAC["Attribute-Based Access Control"]
        PBAC["Policy-Based Access Control"]
    end

    subgraph ENFORCEMENT["ğŸ›¡ï¸ ENFORCEMENT LAYER"]
        GUARDS["Permission Guards"]
        MIDDLEWARE["Middleware Checks"]
        DB["Database Row-Level Security"]
    end

    AUTH --> AUTHZ
    AUTHZ --> RBAC
    AUTHZ --> ABAC
    AUTHZ --> PBAC
    RBAC --> GUARDS
    ABAC --> GUARDS
    PBAC --> GUARDS
    GUARDS --> MIDDLEWARE
    MIDDLEWARE --> DB
```

---

## ğŸ“‹ ROLE DEFINITIONS

### Global Roles

```typescript
export enum GlobalRole {
  ADMIN = "ADMIN",       // Platform administrator
  AUDITOR = "AUDITOR",   // Read-only compliance access
  INVESTOR = "INVESTOR", // Limited financial views
  USER = "USER",         // Standard user (default)
}
```

| Role | Description | Scope | Use Case |
|------|-------------|-------|----------|
| `ADMIN` | Full platform access | All organizations | Platform operators |
| `AUDITOR` | Read-only audit access | All organizations | Compliance officers |
| `INVESTOR` | Limited financial views | Assigned organizations | External stakeholders |
| `USER` | Standard access | Via org membership | Regular users |

### Organization Roles

```typescript
export enum OrgRole {
  OWNER = "OWNER",   // Full control, can delete org
  ADMIN = "ADMIN",   // Manage members and settings
  MEMBER = "MEMBER", // Create and manage data
  VIEWER = "VIEWER", // Read-only access
}
```

| Role | Description | Can Manage Members | Can Delete Org |
|------|-------------|-------------------|----------------|
| `OWNER` | Full organization control | âœ… | âœ… |
| `ADMIN` | Administrative access | âœ… | âŒ |
| `MEMBER` | Standard contributor | âŒ | âŒ |
| `VIEWER` | Read-only observer | âŒ | âŒ |

---

## ğŸ”‘ PERMISSION DEFINITIONS

### Permission Taxonomy

```typescript
export type Permission =
  // User management
  | "users:read"
  | "users:write"
  | "users:delete"
  
  // Organization management
  | "organizations:read"
  | "organizations:write"
  | "organizations:delete"
  
  // Asset management
  | "assets:read"
  | "assets:write"
  | "assets:delete"
  
  // Verification management
  | "verifications:read"
  | "verifications:write"
  
  // Document management
  | "documents:read"
  | "documents:write"
  | "documents:delete"
  
  // API key management
  | "api-keys:read"
  | "api-keys:write"
  
  // Webhook management
  | "webhooks:read"
  | "webhooks:write"
  
  // Audit access
  | "audit:read"
  
  // Settings management
  | "settings:read"
  | "settings:write"
  
  // Member management
  | "members:read"
  | "members:write"
  | "members:delete";
```

### Permission Inheritance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERMISSION INHERITANCE TREE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  assets:delete                                                              â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€â–º assets:write                                                     â”‚
â”‚                 â”‚                                                           â”‚
â”‚                 â””â”€â”€â–º assets:read                                            â”‚
â”‚                                                                             â”‚
â”‚  documents:delete                                                           â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€â–º documents:write                                                  â”‚
â”‚                 â”‚                                                           â”‚
â”‚                 â””â”€â”€â–º documents:read                                         â”‚
â”‚                                                                             â”‚
â”‚  members:delete                                                             â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€â–º members:write                                                    â”‚
â”‚                 â”‚                                                           â”‚
â”‚                 â””â”€â”€â–º members:read                                           â”‚
â”‚                                                                             â”‚
â”‚  RULE: Higher permissions IMPLY lower permissions                          â”‚
â”‚  EXAMPLE: If you have assets:delete, you also have assets:write and read   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š PERMISSION MATRICES

### Global Role Permissions

```json
{
  "ADMIN": ["*"],
  "AUDITOR": [
    "users:read",
    "organizations:read",
    "assets:read",
    "verifications:read",
    "documents:read",
    "audit:read"
  ],
  "INVESTOR": [
    "organizations:read",
    "assets:read",
    "verifications:read"
  ],
  "USER": []
}
```

### Organization Role Permissions

```json
{
  "OWNER": [
    "organizations:read",
    "organizations:write",
    "organizations:delete",
    "assets:read",
    "assets:write",
    "assets:delete",
    "verifications:read",
    "verifications:write",
    "documents:read",
    "documents:write",
    "documents:delete",
    "api-keys:read",
    "api-keys:write",
    "webhooks:read",
    "webhooks:write",
    "settings:read",
    "settings:write",
    "members:read",
    "members:write",
    "members:delete",
    "audit:read"
  ],
  "ADMIN": [
    "organizations:read",
    "organizations:write",
    "assets:read",
    "assets:write",
    "assets:delete",
    "verifications:read",
    "verifications:write",
    "documents:read",
    "documents:write",
    "documents:delete",
    "api-keys:read",
    "api-keys:write",
    "webhooks:read",
    "webhooks:write",
    "settings:read",
    "settings:write",
    "members:read",
    "members:write",
    "audit:read"
  ],
  "MEMBER": [
    "organizations:read",
    "assets:read",
    "assets:write",
    "verifications:read",
    "verifications:write",
    "documents:read",
    "documents:write",
    "api-keys:read",
    "webhooks:read",
    "settings:read"
  ],
  "VIEWER": [
    "organizations:read",
    "assets:read",
    "verifications:read",
    "documents:read",
    "settings:read"
  ]
}
```

### Quick Reference Matrix

| Permission | OWNER | ADMIN | MEMBER | VIEWER |
|------------|-------|-------|--------|--------|
| `organizations:read` | âœ… | âœ… | âœ… | âœ… |
| `organizations:write` | âœ… | âœ… | âŒ | âŒ |
| `organizations:delete` | âœ… | âŒ | âŒ | âŒ |
| `assets:read` | âœ… | âœ… | âœ… | âœ… |
| `assets:write` | âœ… | âœ… | âœ… | âŒ |
| `assets:delete` | âœ… | âœ… | âŒ | âŒ |
| `verifications:read` | âœ… | âœ… | âœ… | âœ… |
| `verifications:write` | âœ… | âœ… | âœ… | âŒ |
| `documents:read` | âœ… | âœ… | âœ… | âœ… |
| `documents:write` | âœ… | âœ… | âœ… | âŒ |
| `documents:delete` | âœ… | âœ… | âŒ | âŒ |
| `api-keys:read` | âœ… | âœ… | âœ… | âŒ |
| `api-keys:write` | âœ… | âœ… | âŒ | âŒ |
| `webhooks:read` | âœ… | âœ… | âœ… | âŒ |
| `webhooks:write` | âœ… | âœ… | âŒ | âŒ |
| `settings:read` | âœ… | âœ… | âœ… | âœ… |
| `settings:write` | âœ… | âœ… | âŒ | âŒ |
| `members:read` | âœ… | âœ… | âŒ | âŒ |
| `members:write` | âœ… | âœ… | âŒ | âŒ |
| `members:delete` | âœ… | âŒ | âŒ | âŒ |
| `audit:read` | âœ… | âœ… | âŒ | âŒ |

---

## ğŸ›¡ï¸ POLICY ENFORCEMENT

### Permission Check Flow

```typescript
async function canPerformAction(
  userId: string,
  organizationId: string,
  permission: Permission
): Promise<boolean> {
  // Step 1: Get user with global role
  const user = await db.user.findUnique({
    where: { id: userId },
    include: {
      organizations: {
        where: { organizationId },
      },
    },
  });

  if (!user) return false;

  // Step 2: Check global role (ADMIN bypasses all)
  if (hasGlobalPermission(user.role, permission)) {
    return true;
  }

  // Step 3: Check organization membership
  const membership = user.organizations[0];
  if (!membership) return false;

  // Step 4: Check organization role
  return hasOrgPermission(membership.role, permission);
}
```

### Guard Implementation

```typescript
export async function requirePermission(
  organizationId: string,
  permission: Permission
): Promise<{ userId: string; organizationId: string }> {
  const session = await getServerSession(authOptions);

  if (!session?.user?.id) {
    throw new ApiError("UNAUTHORIZED", "Authentication required", 401);
  }

  const allowed = await canPerformAction(
    session.user.id,
    organizationId,
    permission
  );

  if (!allowed) {
    // Log the denied attempt for security monitoring
    await createAuditLog({
      action: "permission.denied",
      entityType: "security",
      userId: session.user.id,
      organizationId,
      metadata: { permission, attemptedAction: permission },
    });

    throw new ApiError("FORBIDDEN", "Insufficient permissions", 403);
  }

  return {
    userId: session.user.id,
    organizationId,
  };
}
```

---

## ğŸš¨ RBAC VIOLATION SCENARIOS

### Scenario 1: Horizontal Privilege Escalation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCENARIO: User A tries to access User B's resources in same org           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  User A (MEMBER) â”€â”€â–º GET /api/assets/asset_owned_by_user_b                 â”‚
â”‚                                                                             â”‚
â”‚  EXPECTED BEHAVIOR:                                                         â”‚
â”‚  âœ… If asset belongs to same org: ALLOW (org-level access)                 â”‚
â”‚  âŒ If asset belongs to different org: DENY (403)                          â”‚
â”‚                                                                             â”‚
â”‚  VIOLATION INDICATOR:                                                       â”‚
â”‚  User can access resources outside their organization                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 2: Vertical Privilege Escalation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCENARIO: VIEWER tries to perform ADMIN actions                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  User (VIEWER) â”€â”€â–º DELETE /api/assets/asset_123                            â”‚
â”‚                                                                             â”‚
â”‚  EXPECTED BEHAVIOR:                                                         â”‚
â”‚  âŒ DENY (403) - VIEWER does not have assets:delete                        â”‚
â”‚                                                                             â”‚
â”‚  VIOLATION INDICATOR:                                                       â”‚
â”‚  User can perform actions above their role level                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 3: Cross-Tenant Access

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCENARIO: User in Org A tries to access Org B's data                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  User (OWNER of Org A) â”€â”€â–º GET /api/assets?organizationId=org_b            â”‚
â”‚                                                                             â”‚
â”‚  EXPECTED BEHAVIOR:                                                         â”‚
â”‚  âŒ DENY (403) - No membership in Org B                                    â”‚
â”‚                                                                             â”‚
â”‚  VIOLATION INDICATOR:                                                       â”‚
â”‚  User can access data from organizations they don't belong to               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 4: API Key Scope Violation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCENARIO: Read-only API key used for write operations                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  API Key (scopes: ["assets:read"]) â”€â”€â–º POST /api/assets                    â”‚
â”‚                                                                             â”‚
â”‚  EXPECTED BEHAVIOR:                                                         â”‚
â”‚  âŒ DENY (403) - Key does not have assets:write scope                      â”‚
â”‚                                                                             â”‚
â”‚  VIOLATION INDICATOR:                                                       â”‚
â”‚  API key can perform actions outside its defined scopes                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ KEY ROTATION PROCEDURES

### NEXTAUTH_SECRET Rotation

```typescript
// Step 1: Generate new secret
const newSecret = crypto.randomBytes(32).toString("hex");

// Step 2: Update environment variable
// In production, use secrets manager (AWS Secrets Manager, Vault, etc.)

// Step 3: Deploy with new secret
// Sessions signed with old secret will be invalidated

// Step 4: Monitor for authentication failures
// Expect brief spike as users re-authenticate
```

### API Key Rotation

```typescript
// Step 1: Create new API key
const newKey = await createApiKey({
  name: "Production Key v2",
  scopes: existingKey.scopes,
  organizationId: existingKey.organizationId,
});

// Step 2: Update consuming applications
// Deploy new key to all services

// Step 3: Revoke old key
await revokeApiKey(existingKey.id);

// Step 4: Verify no failed authentications
// Monitor for 401 errors with old key
```

### Database Credential Rotation

```typescript
// Step 1: Create new database user
// CREATE USER proveniq_v2 WITH PASSWORD 'new_secure_password';
// GRANT ALL PRIVILEGES ON DATABASE proveniq TO proveniq_v2;

// Step 2: Update connection string
// DATABASE_URL=postgresql://proveniq_v2:new_password@host/db

// Step 3: Deploy application with new credentials

// Step 4: Revoke old user
// DROP USER proveniq_v1;
```

---

## ğŸ“ AUDIT REQUIREMENTS

### Required Audit Events

| Event | Trigger | Data Captured |
|-------|---------|---------------|
| `user.login` | Successful authentication | userId, ip, userAgent |
| `user.login.failed` | Failed authentication | email, ip, reason |
| `permission.denied` | Authorization failure | userId, resource, permission |
| `asset.created` | Asset creation | assetId, userId, orgId |
| `asset.deleted` | Asset deletion | assetId, userId, orgId |
| `member.added` | User added to org | userId, orgId, role |
| `member.removed` | User removed from org | userId, orgId |
| `api-key.created` | API key generation | keyId, userId, scopes |
| `api-key.revoked` | API key revocation | keyId, userId, reason |
| `secret.rotated` | Secret rotation | secretType, userId |

### Audit Log Schema

```typescript
interface AuditLog {
  id: string;
  action: string;
  entityType: string;
  entityId?: string;
  userId?: string;
  organizationId?: string;
  ipAddress?: string;
  userAgent?: string;
  metadata?: Record<string, unknown>;
  createdAt: Date;
}
```

---

## âœ… COMPLIANCE CHECKLIST

### SOC 2 Type II Requirements

- [ ] Access control policies documented
- [ ] Role definitions reviewed quarterly
- [ ] Permission changes logged
- [ ] Privileged access monitored
- [ ] Access reviews conducted annually

### GDPR Requirements

- [ ] Data access logged
- [ ] Consent tracked
- [ ] Right to access implemented
- [ ] Right to deletion implemented
- [ ] Data portability supported

### Security Best Practices

- [ ] Principle of least privilege enforced
- [ ] Separation of duties implemented
- [ ] Multi-factor authentication available
- [ ] Session timeout configured
- [ ] Failed login lockout enabled

---

*[DRILL_INSTRUCTOR] IAM Policies artifact complete.*
