{
  "$schema": "https://proveniq.com/schemas/academy/assessment-v1.json",
  "metadata": {
    "id": "CERT-PROVENIQ-CORE-2024",
    "title": "Proveniq Core Architect Certification",
    "version": "1.0.0",
    "author": "[EXAMINER]",
    "created": "2024-01-15",
    "duration": 14400,
    "passingScore": 95,
    "maxAttempts": 3,
    "proctored": true
  },

  "sections": [
    {
      "id": "SECTION_A",
      "title": "Architecture",
      "weight": 20,
      "duration": 1800,
      "minimumScore": 80,
      "questions": [
        {
          "id": "A1",
          "type": "multiple_choice",
          "points": 2,
          "question": "What is the correct order of the middleware execution chain?",
          "options": [
            "Auth → Rate Limit → Logging → Route",
            "Rate Limit → Auth → Logging → Route",
            "Logging → Rate Limit → Auth → Route",
            "Rate Limit → Logging → Auth → Route"
          ],
          "correctAnswer": 1,
          "explanation": "Rate limiting must occur first to prevent DoS attacks from consuming authentication resources."
        },
        {
          "id": "A2",
          "type": "multiple_choice",
          "points": 2,
          "question": "Why is the Prisma client instantiated as a singleton in development?",
          "options": [
            "To improve query performance",
            "To prevent connection pool exhaustion during hot reload",
            "To enable query caching",
            "To support multiple databases"
          ],
          "correctAnswer": 1,
          "explanation": "Hot module replacement creates new instances; singleton pattern prevents exhausting database connections."
        },
        {
          "id": "A3",
          "type": "multiple_choice",
          "points": 2,
          "question": "What is the P95 latency target for synchronous API requests?",
          "options": ["100ms", "200ms", "500ms", "1000ms"],
          "correctAnswer": 1,
          "explanation": "200ms P95 ensures responsive user experience while allowing for occasional slower requests."
        },
        {
          "id": "A4",
          "type": "multiple_choice",
          "points": 2,
          "question": "Which component is NOT on the critical path?",
          "options": [
            "Auth Service",
            "RBAC Guards",
            "Webhook Delivery",
            "Tenant Context"
          ],
          "correctAnswer": 2,
          "explanation": "Webhook delivery is asynchronous and does not block user requests."
        },
        {
          "id": "A5",
          "type": "multiple_choice",
          "points": 2,
          "question": "What is the connection pool size optimized for serverless?",
          "options": [
            "5 connections",
            "10 connections",
            "50 connections",
            "100 connections"
          ],
          "correctAnswer": 1,
          "explanation": "10 connections balances availability with serverless function concurrency limits."
        },
        {
          "id": "A6",
          "type": "short_answer",
          "points": 10,
          "question": "Draw the complete request lifecycle from browser to database. Include timing for each stage.",
          "rubric": {
            "components": ["Edge", "Middleware", "Auth", "AuthZ", "Handler", "Prisma", "PostgreSQL"],
            "timing": "Must include realistic timing estimates",
            "total": "Must sum to ~200ms"
          }
        },
        {
          "id": "A7",
          "type": "short_answer",
          "points": 5,
          "question": "What are the five architectural priorities in order? Explain why features are last.",
          "rubric": {
            "priorities": ["Reliability", "Security", "Performance", "Maintainability", "Features"],
            "explanation": "Features that compromise reliability are not shipped"
          }
        },
        {
          "id": "A8",
          "type": "diagram",
          "points": 10,
          "question": "Draw the 8-node Proveniq ecosystem showing all dependencies.",
          "rubric": {
            "nodes": ["CORE", "VERIFY", "INGEST", "PORTAL", "MOBILE", "ANALYTICS", "INTEGRATIONS", "RDS"],
            "dependencies": "Must show correct dependency arrows",
            "labels": "Must label each node with its role"
          }
        }
      ]
    },

    {
      "id": "SECTION_B",
      "title": "Security",
      "weight": 25,
      "duration": 2700,
      "minimumScore": 85,
      "questions": [
        {
          "id": "B1",
          "type": "scenario",
          "points": 20,
          "scenario": {
            "title": "Suspicious API Activity",
            "description": "You receive an alert that a user account has accessed resources in 5 different organizations within 2 minutes, including 3 organizations where they have no membership.",
            "indicators": [
              "500+ failed login attempts from single IP",
              "Successful login after attempts",
              "Access to 3 different organizations",
              "Bulk data export initiated"
            ]
          },
          "subQuestions": [
            {
              "id": "B1a",
              "question": "What is your immediate response? List actions in order of priority.",
              "points": 5,
              "rubric": ["Contain", "Preserve evidence", "Investigate", "Communicate"]
            },
            {
              "id": "B1b",
              "question": "What logs would you examine? Provide specific log queries.",
              "points": 5,
              "rubric": ["Audit logs", "Auth logs", "API access logs", "Specific query syntax"]
            },
            {
              "id": "B1c",
              "question": "How could this have happened? List possible attack vectors.",
              "points": 5,
              "rubric": ["Credential stuffing", "Session hijacking", "RBAC bypass", "API key compromise"]
            },
            {
              "id": "B1d",
              "question": "What evidence would you preserve for forensics?",
              "points": 5,
              "rubric": ["Logs", "Session data", "IP addresses", "Timestamps"]
            }
          ]
        },
        {
          "id": "B2",
          "type": "code_review",
          "points": 20,
          "code": "async function authenticateUser(email: string, password: string) {\n  const user = await db.user.findUnique({ where: { email } });\n  \n  if (!user) {\n    return { error: \"User not found\" };\n  }\n  \n  if (password === user.passwordHash) {\n    const token = jwt.sign({ userId: user.id }, \"secret123\");\n    return { token };\n  }\n  \n  return { error: \"Invalid password\" };\n}",
          "subQuestions": [
            {
              "id": "B2a",
              "question": "List all security vulnerabilities in this code.",
              "points": 10,
              "rubric": {
                "vulnerabilities": [
                  "User enumeration (different error messages)",
                  "Plain text password comparison (should use bcrypt)",
                  "Hardcoded secret",
                  "No rate limiting",
                  "No timing-safe comparison",
                  "No token expiration",
                  "No audit logging"
                ]
              }
            },
            {
              "id": "B2b",
              "question": "Provide corrected code that addresses all issues.",
              "points": 10,
              "rubric": {
                "required": [
                  "bcrypt.compare for password",
                  "Environment variable for secret",
                  "Generic error message",
                  "Token expiration",
                  "Audit logging"
                ]
              }
            }
          ]
        },
        {
          "id": "B3",
          "type": "matrix",
          "points": 10,
          "question": "Complete the permission matrix for documents:delete",
          "matrix": {
            "rows": [
              {"globalRole": "ADMIN", "orgRole": "N/A"},
              {"globalRole": "USER", "orgRole": "OWNER"},
              {"globalRole": "USER", "orgRole": "ADMIN"},
              {"globalRole": "USER", "orgRole": "MEMBER"},
              {"globalRole": "USER", "orgRole": "VIEWER"},
              {"globalRole": "AUDITOR", "orgRole": "MEMBER"}
            ],
            "expectedAnswers": [
              {"hasPermission": true, "reason": "ADMIN has all permissions"},
              {"hasPermission": true, "reason": "OWNER has documents:delete"},
              {"hasPermission": true, "reason": "ADMIN has documents:delete"},
              {"hasPermission": false, "reason": "MEMBER only has documents:write"},
              {"hasPermission": false, "reason": "VIEWER is read-only"},
              {"hasPermission": false, "reason": "AUDITOR is read-only"}
            ]
          }
        }
      ]
    },

    {
      "id": "SECTION_C",
      "title": "Data Flow",
      "weight": 20,
      "duration": 1800,
      "minimumScore": 80,
      "questions": [
        {
          "id": "C1",
          "type": "system_design",
          "points": 20,
          "scenario": {
            "title": "Webhook Delivery System",
            "requirements": [
              "10,000 webhooks per minute capacity",
              "5 retry attempts with exponential backoff",
              "Dead letter queue for permanent failures",
              "Delivery status tracking"
            ]
          },
          "subQuestions": [
            {
              "id": "C1a",
              "question": "Draw the system architecture.",
              "points": 5,
              "rubric": ["Queue", "Workers", "DLQ", "Status tracking", "Retry logic"]
            },
            {
              "id": "C1b",
              "question": "Define the database schema for tracking deliveries.",
              "points": 5,
              "rubric": ["WebhookDelivery table", "Status enum", "Attempt count", "Timestamps"]
            },
            {
              "id": "C1c",
              "question": "Write pseudocode for the retry logic.",
              "points": 5,
              "rubric": ["Exponential backoff", "Max attempts", "DLQ routing"]
            },
            {
              "id": "C1d",
              "question": "What metrics would you monitor?",
              "points": 5,
              "rubric": ["Queue depth", "Delivery latency", "Error rate", "DLQ size"]
            }
          ]
        },
        {
          "id": "C2",
          "type": "problem_solving",
          "points": 10,
          "scenario": {
            "title": "Race Condition",
            "description": "Two users simultaneously update the same asset: User A changes name, User B changes category. Both requests arrive at the same millisecond."
          },
          "subQuestions": [
            {
              "id": "C2a",
              "question": "What could go wrong without proper handling?",
              "points": 3,
              "rubric": ["Lost update", "Data inconsistency", "Last write wins"]
            },
            {
              "id": "C2b",
              "question": "How does optimistic locking solve this? Show implementation.",
              "points": 5,
              "rubric": ["Version field", "Compare-and-swap", "Conflict detection"]
            },
            {
              "id": "C2c",
              "question": "What should the user experience be when a conflict occurs?",
              "points": 2,
              "rubric": ["Error message", "Refresh data", "Retry option"]
            }
          ]
        }
      ]
    },

    {
      "id": "SECTION_D",
      "title": "Financial",
      "weight": 20,
      "duration": 1800,
      "minimumScore": 80,
      "questions": [
        {
          "id": "D1",
          "type": "calculation",
          "points": 20,
          "scenario": {
            "title": "Loan Default Waterfall",
            "data": {
              "loanAmount": 10000000,
              "tranches": [
                {"name": "Senior", "amount": 6000000, "priority": 1},
                {"name": "Mezzanine", "amount": 3000000, "priority": 2},
                {"name": "Equity", "amount": 1000000, "priority": 3}
              ],
              "recoveryAmount": 7500000
            }
          },
          "subQuestions": [
            {
              "id": "D1a",
              "question": "Calculate the loss allocation for each tranche. Show your work.",
              "points": 10,
              "expectedAnswer": {
                "totalLoss": 2500000,
                "equity": {"loss": 1000000, "recovery": 0},
                "mezzanine": {"loss": 1500000, "recovery": 1500000},
                "senior": {"loss": 0, "recovery": 6000000}
              }
            },
            {
              "id": "D1b",
              "question": "What percentage loss does each tranche experience?",
              "points": 5,
              "expectedAnswer": {
                "equity": 100,
                "mezzanine": 50,
                "senior": 0
              }
            },
            {
              "id": "D1c",
              "question": "If there were $50,000 in recovery costs, how would that affect the allocation?",
              "points": 5,
              "expectedAnswer": {
                "netRecovery": 7450000,
                "additionalMezzanineLoss": 50000
              }
            }
          ]
        },
        {
          "id": "D2",
          "type": "code_review",
          "points": 10,
          "code": "function calculateInterest(principal: number, rate: number, days: number) {\n  const dailyRate = rate / 365;\n  const interest = principal * dailyRate * days;\n  return Math.round(interest * 100) / 100;\n}\n\nconst interest = calculateInterest(1000000, 0.05, 30);\nconsole.log(`Interest: $${interest}`);",
          "subQuestions": [
            {
              "id": "D2a",
              "question": "What is wrong with this code?",
              "points": 5,
              "rubric": [
                "Floating point arithmetic for money",
                "Precision loss",
                "No currency handling"
              ]
            },
            {
              "id": "D2b",
              "question": "Provide corrected implementation using proper money handling.",
              "points": 5,
              "rubric": [
                "Integer cents",
                "BigInt for large amounts",
                "Proper rounding"
              ]
            }
          ]
        }
      ]
    },

    {
      "id": "SECTION_E",
      "title": "Incident Response",
      "weight": 15,
      "duration": 2700,
      "minimumScore": 80,
      "questions": [
        {
          "id": "E1",
          "type": "simulation",
          "points": 20,
          "scenario": {
            "title": "Production Incident",
            "severity": "SEV-1",
            "alerts": [
              {"metric": "API error rate", "value": "45%", "normal": "<1%"},
              {"metric": "Database CPU", "value": "98%", "normal": "<70%"},
              {"metric": "Response time P99", "value": "12s", "normal": "500ms"},
              {"metric": "Webhook queue depth", "value": "150000", "normal": "<1000"}
            ],
            "recentChanges": [
              {"time": "2 hours ago", "change": "New report feature deployed"},
              {"time": "1 hour ago", "change": "Marketing email sent to 50,000 users"},
              {"time": "30 min ago", "change": "First alerts triggered"}
            ]
          },
          "subQuestions": [
            {
              "id": "E1a",
              "question": "What is your first action?",
              "points": 2,
              "rubric": ["Acknowledge", "Assess severity", "Page team"]
            },
            {
              "id": "E1b",
              "question": "What is your hypothesis for the root cause?",
              "points": 3,
              "rubric": ["New feature + traffic spike", "Database overload", "Connection exhaustion"]
            },
            {
              "id": "E1c",
              "question": "What commands/queries would you run to confirm?",
              "points": 5,
              "rubric": ["Database queries", "Log queries", "Metrics queries"]
            },
            {
              "id": "E1d",
              "question": "Describe your mitigation strategy.",
              "points": 5,
              "rubric": ["Rollback", "Scale", "Rate limit", "Queue drain"]
            },
            {
              "id": "E1e",
              "question": "Draft a status update for stakeholders.",
              "points": 3,
              "rubric": ["Impact", "Status", "ETA", "Next update"]
            },
            {
              "id": "E1f",
              "question": "What post-incident actions would you recommend?",
              "points": 2,
              "rubric": ["Post-mortem", "Load testing", "Monitoring", "Runbook"]
            }
          ]
        }
      ]
    }
  ],

  "blackSwanEvent": {
    "id": "BLACK_SWAN",
    "title": "Cascading Failure Scenario",
    "weight": 10,
    "description": "During the exam, a simulated cascading failure will be triggered. You must identify and respond in real-time.",
    "triggers": [
      {"time": "random", "event": "Database primary failover"},
      {"time": "random", "event": "Third-party API timeout"},
      {"time": "random", "event": "Memory leak detection"}
    ],
    "gradingCriteria": {
      "detection": "Time to notice the issue",
      "diagnosis": "Accuracy of root cause identification",
      "response": "Appropriateness of mitigation actions",
      "communication": "Quality of status updates"
    }
  },

  "gradingRules": {
    "passingScore": 95,
    "sectionMinimums": {
      "architecture": 80,
      "security": 85,
      "dataFlow": 80,
      "financial": 80,
      "incident": 80
    },
    "autoFail": [
      "Security vulnerability in code review not identified",
      "Leaked API key in any response",
      "Incorrect waterfall calculation",
      "Failed to respond to Black Swan event"
    ],
    "bonusPoints": {
      "exceptionalPerformance": 5,
      "earlyCompletion": 3,
      "blackSwanExcellence": 5
    }
  },

  "certificationLevels": {
    "architect": {
      "minScore": 95,
      "requirements": ["All sections passed", "Black Swan handled"]
    },
    "engineer": {
      "minScore": 90,
      "requirements": ["4/5 sections passed"]
    },
    "operator": {
      "minScore": 85,
      "requirements": ["3/5 sections passed"]
    }
  }
}
